---
- name: Install prerequisite packages
  homebrew:
    name: ["coreutils", "fzf", "gnu-tar", "jq"]
    state: latest

# https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/
- name: Download kubectl
  shell: sh -c 'curl -LO "https://dl.k8s.io/release/v1.21.14/bin/darwin/$(arch)/kubectl"'
  args:
    chdir: /tmp
    creates: /usr/local/bin/kubectl

- name: Install kubectl
  command: sudo mv /tmp/kubectl /usr/local/bin
  args:
    chdir: /tmp
    creates: /usr/local/bin/kubectl

# https://github.com/derailed/k9s
- name: Install k9s
  homebrew:
    name: ["derailed/k9s/k9s"]
    state: latest

# https://github.com/kubermatic/fubectl
- name: Install fubectl
  get_url:
    url: https://rawgit.com/kubermatic/fubectl/master/fubectl.source
    dest: "{{ ansible_env.HOME }}/.fubectl.source"
    mode: '0644'

- name: Enable Kubernetes environment in .zshrc
  lineinfile:
    dest: "{{ ansible_env.HOME }}/.zshrc"
    line: "{{ item }}"
    create: true
    mode: '0644'
  with_items:
    - source {{ REPO_ROOT }}/playbooks/roles/kubernetes/files/k8s_profile.sh
  when: ansible_env.SHELL == "/bin/zsh"
